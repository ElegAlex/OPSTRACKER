# P3.1 - Catalogue d'Options

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 
üí° **CATALOGUE D'OPTIONS (DIVERGENCE)** Nombre d'options g√©n√©r√©es : **21** Confiance globale : **92%**
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

---

## Contexte & Cadrage

### Ce que ce P3.1 traite

**OpsTracker n'est PAS un projet "Build vs Buy"**. Le POC TAM IDF existe et a valid√© les concepts terrain. L'enjeu est de le **g√©n√©riciser** pour le rendre r√©utilisable entre CPAM.

|Contrainte|Valeur|Source|
|---|---|---|
|Framework|**Symfony** (obligatoire Assurance Maladie)|P0|
|H√©bergement|**Self-hosted** CPAM 92|P0|
|Accessibilit√©|**RGAA 4.1** (obligation l√©gale)|P0|
|Licence|**EUPL 1.2** (open source)|P2.1|
|Donn√©es sant√©|**JAMAIS** de NIR/donn√©es patients|P2.1|
|Mode dev|**Vibe coding solo** (DSI = d√©veloppeur)|P0|

### Job-to-be-Done central

> _"Comment architecturer OpsTracker pour que Sophie puisse configurer n'importe quel type d'op√©ration (champs, statuts, segments, checklists) SANS d√©veloppeur, tout en garantissant √† Karim une UX terrain ultra-simple ?"_

### Les 7 domaines de d√©cision architecturale

|Domaine|Question cl√©|
|---|---|
|**A - Mod√®le de donn√©es**|Comment g√©rer les champs configurables par Sophie ?|
|**B - Workflows/Statuts**|Comment permettre des statuts et transitions dynamiques ?|
|**C - Frontend**|Comment servir Sophie (admin) ET Karim (terrain) ?|
|**D - Backoffice**|Comment Sophie configure-t-elle sans toucher au code ?|
|**E - Checklists**|Comment prot√©ger les checklists "in progress" ?|
|**F - Import/Export**|Comment g√©rer les volumes CSV ?|
|**G - Audit**|Comment garantir la tra√ßabilit√© secteur public ?|

---

## 1. Les "Low-Hanging Fruits" (Architecture simple & √©prouv√©e)

_(Approches classiques Symfony, bien document√©es, faible risque)_

|#|Nom de l'option|Description (Le "Quoi")|Pourquoi √ßa marche ?|
|---|---|---|---|
|1|**"Doctrine Classique"**|Entit√©s fixes avec tous les champs possibles. Les champs non utilis√©s restent NULL. Pas de JSONB, pas de magie.|Ultra-simple, 0 risque, Doctrine standard. Mais rigide : chaque nouveau champ = migration + d√©ploiement.|
|2|**"EasyAdmin Express"**|EasyAdmin 4 comme backoffice de configuration pour Sophie. CRUD auto-g√©n√©r√©, dashboards int√©gr√©s, formulaires dynamiques.|Bundle mature (4M+ installs), bien maintenu, UX admin correcte out-of-box. Courbe d'apprentissage faible.|
|3|**"Twig Turbo"**|Frontend 100% Twig + Symfony UX Turbo + Stimulus. Pas de SPA, pas de build JS, HTML progressif.|Accessibilit√© native (HTML s√©mantique), pas de complexit√© React/Vue, rendu serveur = cache facile.|
|4|**"CSV Artisan"**|Import/Export CSV via League\Csv avec mapping manuel dans le code. Simple, synchrone, fichiers < 10k lignes.|Biblioth√®que l√©g√®re, bien test√©e, pas d'infra suppl√©mentaire. Suffisant pour 90% des cas CPAM.|

---

## 2. Les Solutions "Product" (Architecture robuste & scalable)

_(Patterns √©prouv√©s pour configurabilit√© et √©volutivit√©)_

|#|Nom de l'option|Description|Trade-off cl√©|
|---|---|---|---|
|5|**"JSONB Flex"**|Champs dynamiques stock√©s en PostgreSQL JSONB avec index GIN. Structure hybride : colonnes fixes pour les champs syst√®me + JSONB pour les champs custom configur√©s par Sophie.|**Flexibilit√© maximale** vs Complexit√© requ√™tes. Perf excellente avec bons index.|
|6|**"EAV Structur√©"**|Pattern Entity-Attribute-Value classique avec tables s√©par√©es (attribute_definitions, attribute_values). Typage fort, validation native.|**Int√©grit√© donn√©es** vs Requ√™tes N+1, JOINs complexes, perf d√©grad√©e sur gros volumes.|
|7|**"Workflow Engine"**|Symfony Workflow Component pour tous les statuts. D√©finitions YAML charg√©es dynamiquement depuis la BDD. Guards, transitions, events.|**Workflows m√©tier robustes** vs Configuration initiale plus lourde.|
|8|**"Workflower BPMN"**|Moteur BPMN 2.0 complet (phpmentors/workflower) avec bundle Symfony. Compatible √©diteur Camunda.|**Standard industrie** vs Overkill pour workflows simples.|
|9|**"API Platform Core"**|API Platform 3 comme fondation. API REST/GraphQL auto-g√©n√©r√©e, admin React int√©gr√©, OpenAPI natif.|**D√©couplage fort** vs Deux stacks √† maintenir (PHP + JS).|
|10|**"Messenger Async"**|Symfony Messenger pour imports CSV volumineux, notifications, et traitements lourds. Workers asynchrones, retry automatique.|**Scalabilit√©** vs Infra suppl√©mentaire (Redis/RabbitMQ).|
|11|**"Snapshot Checklist"**|Pattern Snapshot pour checklists : √† l'assignation, la structure du template est copi√©e dans un champ JSONB de l'instance. Modifications template n'affectent pas les "in progress".|**Protection garantie** vs Duplication donn√©es. R√©sout LE probl√®me du POC TAM.|
|12|**"Gedmo Audit"**|Extension Gedmo Loggable pour audit trail automatique. Versioning de toutes les entit√©s critiques. Qui a fait quoi, quand.|**Tra√ßabilit√© compl√®te** vs Overhead stockage. Essentiel secteur public.|

---

## 3. Les "Moonshots" & Approches Radicales

_(Innovation architecturale ‚Äî √©valu√©es puis √©cart√©es V1)_

|#|Nom de l'option|Le concept|Statut|
|---|---|---|---|
|13|**"Config-as-Code"**|Configuration (champs, workflows) en YAML versionn√© Git. √âdition UI ‚Üí commit auto.|‚ùå **√âcart√©** ‚Äî Tout passe par console admin, pas de Git|
|14|**"Event Sourcing Ops"**|Chaque changement = √©v√©nement immutable. √âtat = projection. CQRS complet.|‚ùå **√âcart√©** ‚Äî Over-engineering pour le besoin|
|15|**"Multi-Bundle Modulaire"**|Un bundle Symfony par module (PlanningBundle, ChecklistBundle...).|‚ùå **√âcart√©** ‚Äî Complexit√© inutile, monolithe suffit V1|
|16|**"Schema-Driven UI"**|JSON Schema g√©n√®re auto les formulaires + UI.|‚ùå **√âcart√©** ‚Äî EasyAdmin + JSONB suffisent|

---

## 4. Les Solutions "Out-of-the-Box" (Patterns d'autres contextes)

_(Inspir√© d'autres domaines ‚Äî √©valu√©s selon pertinence V1)_

|#|Nom de l'option|Inspir√© de|Concept transpos√©|Statut|
|---|---|---|---|---|
|17|**"Headless CMS Pattern"**|Strapi, Directus|Sophie d√©finit les "content types" via admin.|‚ö†Ô∏è Inspir√© ‚Äî JSONB Flex + EasyAdmin couvrent le besoin|
|18|**"Feature Flags Ops"**|LaunchDarkly|Fonctionnalit√©s activables/d√©sactivables par CPAM.|üí° **V2** ‚Äî Int√©ressant pour multi-CPAM|
|19|**"Template Marketplace"**|WordPress themes|Biblioth√®que de templates de campagnes pr√©-configur√©s. Partage inter-CPAM.|üí° **V2** ‚Äî En V1 : import/export CSV de config|
|20|**"Offline-First PWA"**|Fieldwire|Service Workers + IndexedDB pour Karim hors-ligne.|‚ùå **√âcart√©** ‚Äî Karim a toujours du r√©seau|

---

## 5. L'Option Nucl√©aire (Baseline)

|#|Option|Description|Co√ªt de l'inaction|
|---|---|---|---|
|0|**"POC TAM Tel Quel"**|Garder le POC TAM IDF sans le g√©n√©riciser. Chaque CPAM fork et adapte elle-m√™me.|**Duplication** : 4 CPAM = 4 forks divergents. **Rigidit√©** : Chaque adaptation = dev custom. **Estimation** : 3-6 mois/CPAM vs 4-6 semaines pour g√©n√©riciser une fois.|

---

## 6. Synth√®se : Les Familles de Solutions

### üóÑÔ∏è **Famille A ‚Äî Mod√®le de Donn√©es**

_Question : Comment g√©rer les champs configurables par Sophie ?_

|Option|Flexibilit√©|Performance|Complexit√©|Verdict|
|---|---|---|---|---|
|#1 Doctrine Classique|‚≠ê|‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê|‚≠ê|‚ùå Trop rigide|
|#5 JSONB Flex|‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê|‚≠ê‚≠ê‚≠ê‚≠ê|‚≠ê‚≠ê‚≠ê|‚úÖ **RETENU**|
|#6 EAV Structur√©|‚≠ê‚≠ê‚≠ê‚≠ê|‚≠ê‚≠ê|‚≠ê‚≠ê‚≠ê‚≠ê|‚ùå Perf insuffisante|

---

### ‚öôÔ∏è **Famille B ‚Äî Gestion des Workflows/Statuts**

_Question : Comment permettre des statuts et transitions dynamiques ?_

|Option|Standard|Flexibilit√©|Courbe apprentissage|Verdict|
|---|---|---|---|---|
|#7 Workflow Engine|Symfony natif|‚≠ê‚≠ê‚≠ê‚≠ê|‚≠ê‚≠ê|‚úÖ **RETENU**|
|#8 Workflower BPMN|BPMN 2.0|‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê|‚≠ê‚≠ê‚≠ê‚≠ê|‚ùå Overkill V1|

---

### üñ•Ô∏è **Famille C ‚Äî Stack Frontend**

_Question : Comment servir Sophie (admin) ET Karim (terrain) ?_

|Option|Accessibilit√© RGAA|Complexit√©|Maintenance|Verdict|
|---|---|---|---|---|
|#3 Twig Turbo|‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (HTML natif)|‚≠ê‚≠ê|‚≠ê‚≠ê|‚úÖ **RETENU**|
|#9 API Platform Core|‚≠ê‚≠ê‚≠ê (d√©pend du front)|‚≠ê‚≠ê‚≠ê‚≠ê|‚≠ê‚≠ê‚≠ê‚≠ê|‚ùå Trop complexe solo|

---

### üõ†Ô∏è **Famille D ‚Äî Backoffice Configuration**

_Question : Comment Sophie configure-t-elle sans toucher au code ?_

|Option|Maturit√©|Personnalisation|UX Admin|Verdict|
|---|---|---|---|---|
|#2 EasyAdmin Express|‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê|‚≠ê‚≠ê‚≠ê|‚≠ê‚≠ê‚≠ê‚≠ê|‚úÖ **RETENU**|

---

### ‚úÖ **Famille E ‚Äî Protection Checklists**

_Question : Comment √©viter l'√©crasement du suivi quand Sophie modifie un template ?_

|Option|Garantie protection|Complexit√©|Audit|Verdict|
|---|---|---|---|---|
|#11 Snapshot Checklist|‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê|‚≠ê‚≠ê|‚≠ê‚≠ê‚≠ê|‚úÖ **RETENU**|
|#14 Event Sourcing|‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê|‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê|‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê|‚ùå Over-engineering|

---

### üì¶ **Famille F ‚Äî Import/Export**

_Question : Comment g√©rer les volumes CSV ?_

|Option|Volumes support√©s|Infra requise|Complexit√©|Verdict|
|---|---|---|---|---|
|#4 CSV Artisan|< 10k lignes|Aucune|‚≠ê|‚úÖ **RETENU V1**|
|#10 Messenger Async|Illimit√©|Redis/RabbitMQ|‚≠ê‚≠ê‚≠ê|üí° V1.1 si besoin|
|#19 Template Marketplace|N/A (config)|Aucune|‚≠ê‚≠ê|üí° **V2**|

---

### üìù **Famille G ‚Äî Tra√ßabilit√© & Audit**

_Question : Comment garantir la tra√ßabilit√© secteur public ?_

|Option|Couverture|Effort int√©gration|Verdict|
|---|---|---|---|
|#12 Gedmo Audit|‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê|‚≠ê‚≠ê|‚úÖ **RETENU**|

---

## 7. Combinaison Retenue ‚Äî Architecture OpsTracker V1

### Vue d'ensemble

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        FRONTEND                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îÇ
‚îÇ  ‚îÇ   Sophie (Admin) ‚îÇ    ‚îÇ  Karim (Terrain) ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ   EasyAdmin 4    ‚îÇ    ‚îÇ  Twig + Turbo    ‚îÇ                    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ                      ‚îÇ
            ‚ñº                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     SYMFONY 7.x                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ   Workflow    ‚îÇ  ‚îÇ   League\Csv ‚îÇ  ‚îÇ    Gedmo     ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  Component    ‚îÇ  ‚îÇ   (import)   ‚îÇ  ‚îÇ  Loggable    ‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    POSTGRESQL 15+                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ  Colonnes fixes    ‚îÇ    JSONB (champs custom)     ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  id, status, ...   ‚îÇ    {"matricule": "A123", ...}‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                    + Index GIN                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Stack technique

|Couche|Choix|Bundle/Lib|Justification|
|---|---|---|---|
|**Donn√©es**|#5 JSONB Flex|Doctrine + PostgreSQL|Flexibilit√© + Performance|
|**Workflows**|#7 Symfony Workflow|`symfony/workflow`|Natif, configurable en BDD|
|**Frontend Sophie**|#2 EasyAdmin 4|`easycorp/easyadmin-bundle`|Rapide, mature, 4M+ installs|
|**Frontend Karim**|#3 Twig + Turbo|`symfony/ux-turbo` + `stimulus`|RGAA natif, pas de build JS|
|**Checklists**|#11 Snapshot Pattern|Custom (JSONB)|R√©sout probl√®me POC TAM|
|**Import CSV**|#4 CSV Artisan|`league/csv`|L√©g√®re, performante|
|**Export Config**|CSV de templates|`league/csv`|Partage inter-CPAM V1|
|**Audit**|#12 Gedmo Loggable|`gedmo/doctrine-extensions`|Standard secteur public|

---

## 8. D√©tail Technique de la Combinaison Retenue

### 8.1 JSONB Flex ‚Äî Mod√®le de Donn√©es Hybride

**Principe** : Structure hybride avec colonnes fixes (syst√®me) + JSONB (champs custom de Sophie).

#### Structure de donn√©es

```
‚îå‚îÄ Table: operation_type ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                 ‚îÇ
‚îÇ  id (UUID)                                                      ‚îÇ
‚îÇ  name: "Migration Windows 11"                                   ‚îÇ
‚îÇ  slug: "migration-w11"                                          ‚îÇ
‚îÇ  field_schema: {                    ‚óÑ‚îÄ‚îÄ D√©finition des champs  ‚îÇ
‚îÇ    "fields": [                          configur√©s par Sophie   ‚îÇ
‚îÇ      {                                                          ‚îÇ
‚îÇ        "name": "matricule",                                     ‚îÇ
‚îÇ        "label": "Matricule Agent",                              ‚îÇ
‚îÇ        "type": "string",                                        ‚îÇ
‚îÇ        "required": true,                                        ‚îÇ
‚îÇ        "searchable": true                                       ‚îÇ
‚îÇ      },                                                         ‚îÇ
‚îÇ      {                                                          ‚îÇ
‚îÇ        "name": "num_poste",                                     ‚îÇ
‚îÇ        "label": "N¬∞ Poste",                                     ‚îÇ
‚îÇ        "type": "string",                                        ‚îÇ
‚îÇ        "required": true                                         ‚îÇ
‚îÇ      },                                                         ‚îÇ
‚îÇ      {                                                          ‚îÇ
‚îÇ        "name": "bureau",                                        ‚îÇ
‚îÇ        "label": "Bureau",                                       ‚îÇ
‚îÇ        "type": "string",                                        ‚îÇ
‚îÇ        "required": false                                        ‚îÇ
‚îÇ      }                                                          ‚îÇ
‚îÇ    ]                                                            ‚îÇ
‚îÇ  }                                                              ‚îÇ
‚îÇ  workflow_name: "operation_standard"  ‚óÑ‚îÄ‚îÄ Lien vers workflow   ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ Table: operation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                 ‚îÇ
‚îÇ  COLONNES FIXES (syst√®me)         JSONB (configurable)         ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ        ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ         ‚îÇ
‚îÇ  id (UUID)                        custom_fields: {             ‚îÇ
‚îÇ  operation_type_id (FK)             "matricule": "A12345",     ‚îÇ
‚îÇ  status (VARCHAR)                   "num_poste": "PC-0042",    ‚îÇ
‚îÇ  assigned_to (FK User)              "bureau": "B204"           ‚îÇ
‚îÇ  scheduled_at (TIMESTAMP)         }                            ‚îÇ
‚îÇ  created_at (TIMESTAMP)                                        ‚îÇ
‚îÇ  updated_at (TIMESTAMP)                                        ‚îÇ
‚îÇ  created_by (FK User)                                          ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Entit√© Doctrine

```php
#[ORM\Entity(repositoryClass: OperationRepository::class)]
#[Gedmo\Loggable]
class Operation
{
    #[ORM\Id]
    #[ORM\Column(type: 'uuid')]
    private Uuid $id;

    #[ORM\ManyToOne(targetEntity: OperationType::class)]
    #[ORM\JoinColumn(nullable: false)]
    private OperationType $operationType;

    #[ORM\Column(length: 50)]
    #[Gedmo\Versioned]
    private string $status = 'a_planifier';

    #[ORM\Column(type: Types::JSON, options: ['jsonb' => true])]
    #[Gedmo\Versioned]
    private array $customFields = [];

    #[ORM\ManyToOne(targetEntity: User::class)]
    private ?User $assignedTo = null;

    #[ORM\Column(type: Types::DATETIME_IMMUTABLE, nullable: true)]
    private ?\DateTimeImmutable $scheduledAt = null;

    // Accesseurs dynamiques
    public function getCustomField(string $name): mixed
    {
        return $this->customFields[$name] ?? null;
    }

    public function setCustomField(string $name, mixed $value): self
    {
        $this->customFields[$name] = $value;
        return $this;
    }
}
```

#### Index PostgreSQL

```sql
-- Index GIN pour recherches JSONB
CREATE INDEX idx_operation_custom_fields 
ON operation USING GIN (custom_fields jsonb_path_ops);

-- Index partiel pour champs fr√©quemment recherch√©s
CREATE INDEX idx_operation_matricule 
ON operation ((custom_fields->>'matricule')) 
WHERE custom_fields->>'matricule' IS NOT NULL;
```

#### Ce que √ßa permet √† Sophie

|Action|Comment|
|---|---|
|Cr√©er un type d'op√©ration avec ses champs|Via EasyAdmin, √©diteur JSON du `field_schema`|
|Importer un CSV|Mapping visuel colonnes ‚Üí champs custom|
|Filtrer/rechercher sur n'importe quel champ|Index GIN, requ√™tes JSONB|
|Ajouter un champ en cours d'op√©ration|Modification du `field_schema`, z√©ro migration|

---

### 8.2 Symfony Workflow ‚Äî Statuts Dynamiques

**Principe** : Workflows stock√©s en BDD, charg√©s dynamiquement. Sophie d√©finit ses statuts et transitions via EasyAdmin.

#### Structure de donn√©es

```
‚îå‚îÄ Table: workflow_definition ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                 ‚îÇ
‚îÇ  id: "workflow_migration_w11"                                   ‚îÇ
‚îÇ  name: "Workflow Migration Windows 11"                          ‚îÇ
‚îÇ  definition: {                                                  ‚îÇ
‚îÇ    "places": [                                                  ‚îÇ
‚îÇ      {"name": "a_planifier", "label": "√Ä planifier", "color": "#9ca3af"},
‚îÇ      {"name": "planifie", "label": "Planifi√©", "color": "#3b82f6"},
‚îÇ      {"name": "en_cours", "label": "En cours", "color": "#f97316"},
‚îÇ      {"name": "realise", "label": "R√©alis√©", "color": "#22c55e"},
‚îÇ      {"name": "reporte", "label": "Report√©", "color": "#ef4444"},
‚îÇ      {"name": "a_remedier", "label": "√Ä rem√©dier", "color": "#a855f7"}
‚îÇ    ],                                                           ‚îÇ
‚îÇ    "transitions": [                                             ‚îÇ
‚îÇ      {                                                          ‚îÇ
‚îÇ        "name": "planifier",                                     ‚îÇ
‚îÇ        "from": ["a_planifier"],                                 ‚îÇ
‚îÇ        "to": "planifie",                                        ‚îÇ
‚îÇ        "allowed_roles": ["ROLE_GESTIONNAIRE", "ROLE_ADMIN"]     ‚îÇ
‚îÇ      },                                                         ‚îÇ
‚îÇ      {                                                          ‚îÇ
‚îÇ        "name": "demarrer",                                      ‚îÇ
‚îÇ        "from": ["planifie"],                                    ‚îÇ
‚îÇ        "to": "en_cours",                                        ‚îÇ
‚îÇ        "allowed_roles": ["ROLE_TECHNICIEN"]                     ‚îÇ
‚îÇ      },                                                         ‚îÇ
‚îÇ      {                                                          ‚îÇ
‚îÇ        "name": "terminer",                                      ‚îÇ
‚îÇ        "from": ["en_cours"],                                    ‚îÇ
‚îÇ        "to": "realise",                                         ‚îÇ
‚îÇ        "allowed_roles": ["ROLE_TECHNICIEN"]                     ‚îÇ
‚îÇ      },                                                         ‚îÇ
‚îÇ      {                                                          ‚îÇ
‚îÇ        "name": "reporter",                                      ‚îÇ
‚îÇ        "from": ["planifie", "en_cours"],                        ‚îÇ
‚îÇ        "to": "reporte",                                         ‚îÇ
‚îÇ        "requires_comment": true                                 ‚îÇ
‚îÇ      }                                                          ‚îÇ
‚îÇ    ],                                                           ‚îÇ
‚îÇ    "initial_place": "a_planifier"                               ‚îÇ
‚îÇ  }                                                              ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Ce que √ßa permet √† Sophie

|Action|Comment|
|---|---|
|D√©finir les statuts|Ajout dans `places` avec nom, label, couleur|
|D√©finir les transitions|Ajout dans `transitions` avec from/to|
|Restreindre par r√¥le|`allowed_roles` sur chaque transition|
|Exiger un commentaire|`requires_comment: true` (ex: report)|
|Visualiser le workflow|Export GraphViz automatique|

---

### 8.3 Twig + Turbo ‚Äî Frontend Accessible

**Principe** : HTML serveur classique, r√©activit√© via Turbo Frames. RGAA 4.1 by design.

#### Structure des vues

```
templates/
‚îú‚îÄ‚îÄ terrain/                          # Interface Karim
‚îÇ   ‚îú‚îÄ‚îÄ base.html.twig               # Layout √©pur√©
‚îÇ   ‚îú‚îÄ‚îÄ mes_interventions.html.twig  # Vue par d√©faut
‚îÇ   ‚îú‚îÄ‚îÄ intervention/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ show.html.twig           # D√©tail intervention
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ _checklist.html.twig     # Turbo Frame checklist
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ _status_buttons.html.twig
‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ       ‚îú‚îÄ‚îÄ _card.html.twig          # Carte intervention
‚îÇ       ‚îî‚îÄ‚îÄ _doc_modal.html.twig     # Modal documentation
‚îÇ
‚îú‚îÄ‚îÄ admin/                            # Via EasyAdmin (auto-g√©n√©r√©)
‚îÇ   ‚îî‚îÄ‚îÄ dashboard.html.twig          # Dashboard Sophie custom
```

#### Principes RGAA int√©gr√©s

|Crit√®re RGAA|Impl√©mentation|
|---|---|
|Contraste 4.5:1|Variables CSS avec couleurs valid√©es|
|Focus visible|`outline: 3px solid` sur `:focus-visible`|
|Pas de couleur seule|Ic√¥nes + texte en plus des couleurs de statut|
|Cibles tactiles 44x44px|`min-height: 44px` sur tous les boutons|
|Navigation clavier|HTML s√©mantique, `tabindex` appropri√©s|
|R√©duction animations|`@media (prefers-reduced-motion)`|

---

### 8.4 EasyAdmin ‚Äî Backoffice Sophie

**Principe** : CRUD complet pour toute la configuration, sans code.

#### Menu Sophie

```
üìä Tableau de bord
‚îÇ
‚îú‚îÄ‚îÄ üìã Op√©rations
‚îÇ   ‚îú‚îÄ‚îÄ Op√©rations en cours
‚îÇ   ‚îî‚îÄ‚îÄ Types d'op√©rations      ‚óÑ‚îÄ‚îÄ D√©finition champs custom
‚îÇ
‚îú‚îÄ‚îÄ ‚öôÔ∏è Configuration
‚îÇ   ‚îú‚îÄ‚îÄ Workflows               ‚óÑ‚îÄ‚îÄ D√©finition statuts/transitions
‚îÇ   ‚îú‚îÄ‚îÄ Checklists              ‚óÑ‚îÄ‚îÄ Templates de checklists
‚îÇ   ‚îî‚îÄ‚îÄ Documents               ‚óÑ‚îÄ‚îÄ Base documentaire
‚îÇ
‚îú‚îÄ‚îÄ üì• Import/Export
‚îÇ   ‚îú‚îÄ‚îÄ Importer CSV            ‚óÑ‚îÄ‚îÄ Upload + mapping
‚îÇ   ‚îî‚îÄ‚îÄ Exporter configuration  ‚óÑ‚îÄ‚îÄ CSV des templates (partage inter-CPAM)
‚îÇ
‚îî‚îÄ‚îÄ üë• Utilisateurs
    ‚îî‚îÄ‚îÄ Gestion des comptes
```

---

### 8.5 Snapshot Checklist ‚Äî Protection In Progress

**Principe** : √Ä l'assignation, la structure du template est **copi√©e** dans l'instance. Sophie peut modifier le template sans affecter les checklists en cours.

#### Structure de donn√©es

```
‚îå‚îÄ Table: checklist_template ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                 ‚îÇ
‚îÇ  id: "tpl_migration_w11"                                        ‚îÇ
‚îÇ  name: "Checklist Migration Windows 11"                         ‚îÇ
‚îÇ  version: 3                                                     ‚îÇ
‚îÇ  structure: {                                                   ‚îÇ
‚îÇ    "phases": [                                                  ‚îÇ
‚îÇ      {                                                          ‚îÇ
‚îÇ        "name": "Pr√©paration",                                   ‚îÇ
‚îÇ        "items": [                                               ‚îÇ
‚îÇ          {"id": "prep_1", "label": "Sauvegarder profil", "doc_id": "doc_123"},
‚îÇ          {"id": "prep_2", "label": "V√©rifier espace disque"}    ‚îÇ
‚îÇ        ]                                                        ‚îÇ
‚îÇ      },                                                         ‚îÇ
‚îÇ      {                                                          ‚îÇ
‚îÇ        "name": "Migration",                                     ‚îÇ
‚îÇ        "items": [                                               ‚îÇ
‚îÇ          {"id": "mig_1", "label": "Lancer script", "doc_id": "doc_456"},
‚îÇ          {"id": "mig_2", "label": "V√©rifier d√©marrage W11"}     ‚îÇ
‚îÇ        ]                                                        ‚îÇ
‚îÇ      }                                                          ‚îÇ
‚îÇ    ]                                                            ‚îÇ
‚îÇ  }                                                              ‚îÇ
‚îÇ  is_active: true                                                ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ Table: checklist_instance ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                 ‚îÇ
‚îÇ  id: "inst_abc123"                                              ‚îÇ
‚îÇ  operation_id: "op_xyz789"                                      ‚îÇ
‚îÇ  template_id: "tpl_migration_w11"                               ‚îÇ
‚îÇ  template_version: 3                ‚óÑ‚îÄ‚îÄ Version fig√©e           ‚îÇ
‚îÇ  snapshot_structure: { ... }        ‚óÑ‚îÄ‚îÄ COPIE au moment assign  ‚îÇ
‚îÇ  progress: {                        ‚óÑ‚îÄ‚îÄ Avancement Karim        ‚îÇ
‚îÇ    "prep_1": {"checked": true, "checked_at": "...", "checked_by": "karim"},
‚îÇ    "prep_2": {"checked": true, "checked_at": "...", "checked_by": "karim"},
‚îÇ    "mig_1": {"checked": false}                                  ‚îÇ
‚îÇ  }                                                              ‚îÇ
‚îÇ  started_at: "2025-01-18T10:20:00"                              ‚îÇ
‚îÇ  completed_at: null                                             ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Ce que √ßa garantit

|Sc√©nario|Comportement|
|---|---|
|Sophie modifie un template|Seules les NOUVELLES interventions utilisent la nouvelle version|
|Karim continue son travail|Sa checklist reste stable, progression pr√©serv√©e|
|Audit|On sait quelle version du template √©tait utilis√©e|

---

### 8.6 CSV Artisan ‚Äî Import Simple

**Principe** : Import en 3 √©tapes avec mapping visuel.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Upload CSV  ‚îÇ ‚îÄ‚îÄ‚ñ∫ ‚îÇ   Preview   ‚îÇ ‚îÄ‚îÄ‚ñ∫ ‚îÇ   Mapping   ‚îÇ ‚îÄ‚îÄ‚ñ∫ ‚îÇ   Import    ‚îÇ
‚îÇ             ‚îÇ     ‚îÇ (10 lignes) ‚îÇ     ‚îÇ  colonnes   ‚îÇ     ‚îÇ  (batch)    ‚îÇ
‚îÇ             ‚îÇ     ‚îÇ             ‚îÇ     ‚îÇ  ‚Üí champs   ‚îÇ     ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Export configuration** (V1) : Export CSV des types d'op√©rations et templates pour partage inter-CPAM.

---

### 8.7 Gedmo Audit ‚Äî Tra√ßabilit√©

**Principe** : Chaque modification trac√©e automatiquement.

```
‚îå‚îÄ Table: ext_log_entries ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                 ‚îÇ
‚îÇ  id: 1                                                          ‚îÇ
‚îÇ  action: "update"                                               ‚îÇ
‚îÇ  logged_at: "2025-01-18 14:32:00"                               ‚îÇ
‚îÇ  object_id: "op_xyz789"                                         ‚îÇ
‚îÇ  object_class: "App\Entity\Operation"                           ‚îÇ
‚îÇ  version: 3                                                     ‚îÇ
‚îÇ  data: {"status": "realise"}        ‚óÑ‚îÄ‚îÄ Nouvelle valeur         ‚îÇ
‚îÇ  username: "karim@cpam.fr"          ‚óÑ‚îÄ‚îÄ Qui a modifi√©           ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 9. Roadmap des Options

|Option|V1|V1.1|V2|
|---|:-:|:-:|:-:|
|#5 JSONB Flex|‚úÖ|||
|#7 Symfony Workflow|‚úÖ|||
|#3 Twig + Turbo|‚úÖ|||
|#2 EasyAdmin|‚úÖ|||
|#11 Snapshot Checklist|‚úÖ|||
|#4 CSV Artisan|‚úÖ|||
|#12 Gedmo Audit|‚úÖ|||
|#10 Messenger Async||‚úÖ||
|#19 Template Marketplace|||‚úÖ|
|#18 Feature Flags|||‚úÖ|

---

## 10. Points Valid√©s avec le Sponsor ‚úÖ

| #   | Question                                                             | D√©cision                                        |
| --- | -------------------------------------------------------------------- | ----------------------------------------------- |
| 1   | Options cloud US (Notion, etc.) acceptables ?                        | ‚ùå V1 ou rien ‚Äî self-hosted obligatoire          |
| 2   | Moonshots (#13-16) pour V2 ?                                         | ‚ùå √âcart√© ‚Äî tout via console admin int√©gr√©e      |
| 3   | Analogies UX (#15-18) culturellement OK ?                            | ‚ùå √âcart√© ‚Äî non envisageable en CPAM             |
| 4   | Priorit√© vitesse vs fit parfait ?                                    | **Fit parfait** ‚Äî vitesse via vibe coding       |
| 5   | Offline-First (#20) n√©cessaire V1 ?                                  | ‚ùå Karim a toujours du r√©seau                    |
| 6   | Template Marketplace (#19) V1 ou V2 ?                                | üí° **V2** ‚Äî En V1 : import/export CSV de config |
| 7   | Combinaison JSONB + Workflow + Twig + EasyAdmin + Snapshot + Gedmo ? | ‚úÖ **Valid√©e**                                   |

---

**Niveau de confiance : 92%**

_Les 8% d'incertitude portent sur la complexit√© r√©elle du workflow dynamique charg√© depuis la BDD (√† prototyper) et sur les cas limites du JSONB avec des volumes > 10k op√©rations._

---

**Statut** : üü¢ **P3.1 VALID√â ‚Äî COMBINAISON ARCHITECTURE RETENUE**

_Prochaine √©tape : P3.2 (Benchmark) si comparaison souhait√©e OU P3.4 (Concept) directement_