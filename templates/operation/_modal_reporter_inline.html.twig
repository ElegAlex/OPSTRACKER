{#
    Modale de report inline pour la vue liste des operations.
    Utilisee quand Sophie selectionne "Reporte" dans le dropdown de statut.

    Parametres requis : operation, campagne
#}
<div id="modal-reporter-{{ operation.id }}"
     class="hidden fixed inset-0 bg-ink/50 z-50 items-center justify-center p-4"
     onclick="if(event.target === this) closeReporterModal({{ operation.id }})">

    <div class="bg-white border-2 border-ink w-full max-w-md p-6">
        <h3 class="text-lg font-bold text-ink mb-4 flex items-center gap-2">
            <i data-feather="pause-circle" class="w-5 h-5 text-warning"></i>
            Reporter l'operation
        </h3>

        <form action="{{ path('app_operation_transition', {campagne: campagne.id, id: operation.id, transition: 'reporter'}) }}" method="post">
            <input type="hidden" name="_token" value="{{ csrf_token('operation_transition_' ~ operation.id) }}">

            {# Info RDV actuel #}
            {% if operation.datePlanifiee %}
            <div class="mb-4 p-3 bg-primary/10 border border-primary/20">
                <p class="text-sm text-ink">
                    <strong>RDV actuel :</strong> {{ operation.datePlanifiee|format_datetime('long', 'short', locale='fr') }}
                </p>
                {% if operation.datePlanifieeInitiale %}
                <p class="text-xs text-muted mt-1">
                    Date initiale : {{ operation.datePlanifieeInitiale|format_datetime('medium', 'short', locale='fr') }}
                    â€” {{ operation.nombreReports }} report{{ operation.nombreReports > 1 ? 's' : '' }}
                </p>
                {% endif %}
            </div>
            {% endif %}

            {# Motif #}
            <div class="mb-4">
                <label class="block text-sm font-medium text-ink mb-2">Motif du report (optionnel)</label>
                <textarea name="motif" rows="2" class="w-full px-3 py-2 border-2 border-ink/20 focus:border-warning outline-none text-sm" placeholder="Agent absent, materiel indisponible...">{{ operation.motifReport }}</textarea>
            </div>

            {# Nouvelle date #}
            <div class="mb-4">
                <label class="block text-sm font-medium text-ink mb-2">Nouveau creneau (optionnel)</label>
                <p class="text-xs text-muted mb-2">
                    Si non renseigne, l'operation passera en "A replanifier".
                </p>
                <div class="flex gap-2">
                    <input type="date"
                           name="nouvelle_date"
                           min="{{ 'now'|date('Y-m-d') }}"
                           class="flex-1 px-3 py-2 border-2 border-ink/20 focus:border-warning outline-none text-sm">
                    <input type="time"
                           name="nouvelle_heure"
                           value="09:00"
                           class="w-28 px-3 py-2 border-2 border-ink/20 focus:border-warning outline-none text-sm">
                </div>
            </div>

            {# Boutons #}
            <div class="flex gap-3">
                <button type="button"
                        onclick="closeReporterModal({{ operation.id }})"
                        class="flex-1 px-4 py-2 text-sm font-medium text-muted border-2 border-ink/10 hover:border-ink hover:text-ink transition-colors">
                    Annuler
                </button>
                <button type="submit" class="flex-1 px-4 py-2 text-sm font-semibold text-white bg-warning hover:bg-warning/90 transition-colors">
                    Confirmer
                </button>
            </div>
        </form>
    </div>
</div>
