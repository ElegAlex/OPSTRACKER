{% extends 'campagne/_layout.html.twig' %}

{% block title %}Workflow - {{ campagne.nom }} - OpsTracker{% endblock %}

{% block main %}
{# HEADER #}
<header class="bg-white px-12 py-10 border-b-4 border-ink">
    <div class="flex justify-between items-start">
        <div>
            <div class="flex items-center gap-3 mb-2">
                <div class="w-3 h-3 bg-{{ campagne.statutCouleur }}"></div>
                <span class="text-xs font-semibold text-muted uppercase tracking-[0.15em]">Campagne</span>
            </div>
            <h1 class="text-4xl font-bold tracking-tight">Configuration Workflow</h1>
            <p class="text-sm text-muted mt-2">{{ campagne.nom }}</p>
        </div>
        <a href="{{ path('app_dashboard_campagne', {id: campagne.id}) }}" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-muted hover:text-ink transition-colors">
            <i data-feather="arrow-left" class="w-4 h-4"></i>
            Retour
        </a>
    </div>
</header>

{# CONTENT #}
<div class="flex-1 overflow-auto">
    <div class="px-12 py-10">

        {# Flash messages #}
        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="mb-6 p-4 border-2 border-ink/20 bg-{{ label == 'success' ? 'success' : 'danger' }}/10 flex items-center gap-3">
                    <i data-feather="{{ label == 'success' ? 'check-circle' : 'alert-circle' }}" class="w-5 h-5 text-{{ label == 'success' ? 'success' : 'danger' }}"></i>
                    <span class="text-sm font-medium">{{ message }}</span>
                </div>
            {% endfor %}
        {% endfor %}

        <div class="max-w-2xl">
            {# Info configuration actuelle #}
            <div class="bg-white border-2 border-ink p-6 mb-8">
                <h3 class="text-sm font-bold text-muted uppercase tracking-wider mb-4">Configuration actuelle</h3>

                <div class="space-y-4">
                    {# Type d'operation #}
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-primary/10 flex items-center justify-center">
                            <i data-feather="briefcase" class="w-6 h-6 text-primary"></i>
                        </div>
                        <div>
                            <p class="text-xs text-muted uppercase tracking-wider">Type d'operation</p>
                            <p class="font-bold text-ink">
                                {% if campagne.typeOperation %}
                                    {{ campagne.typeOperation.nom }}
                                {% else %}
                                    <span class="text-muted font-normal">Non defini</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>

                    {# Template checklist #}
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-success/10 flex items-center justify-center">
                            <i data-feather="check-square" class="w-6 h-6 text-success"></i>
                        </div>
                        <div>
                            <p class="text-xs text-muted uppercase tracking-wider">Template de checklist</p>
                            <p class="font-bold text-ink">
                                {% if campagne.checklistTemplate %}
                                    {{ campagne.checklistTemplate.nom }}
                                    <span class="text-sm font-normal text-muted">
                                        (v{{ campagne.checklistTemplate.version }} - {{ campagne.checklistTemplate.nombreEtapes }} etapes)
                                    </span>
                                {% else %}
                                    <span class="text-muted font-normal">Non defini</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            {# Avertissement si operations existantes #}
            {% if campagne.operations|length > 0 %}
            <div class="mb-6 p-4 border-2 border-warning bg-warning/10 flex items-start gap-3">
                <i data-feather="alert-triangle" class="w-5 h-5 text-warning flex-shrink-0 mt-0.5"></i>
                <div>
                    <p class="text-sm font-bold text-warning">Attention</p>
                    <p class="text-sm text-muted mt-1">
                        Cette campagne contient <strong>{{ campagne.operations|length }} operation(s)</strong>.
                        Modifier le template de checklist n'affectera pas les checklists deja instanciees sur les operations existantes.
                        Seules les nouvelles operations utiliseront le nouveau template.
                    </p>
                </div>
            </div>
            {% endif %}

            {# Formulaire #}
            <div class="bg-white border-2 border-ink p-6">
                <h3 class="text-sm font-bold text-muted uppercase tracking-wider mb-6">Modifier la configuration</h3>

                {{ form_start(form, {attr: {class: 'space-y-6'}}) }}

                {# Type d'operation #}
                <div>
                    <label for="{{ form.typeOperation.vars.id }}" class="block text-sm font-semibold text-ink uppercase tracking-wider mb-2">
                        {{ form_label(form.typeOperation) }}
                    </label>
                    {{ form_widget(form.typeOperation) }}
                    <p class="text-xs text-muted mt-2">
                        Le type d'operation definit la nature des interventions de cette campagne.
                    </p>
                    {{ form_errors(form.typeOperation) }}
                </div>

                {# Template de checklist #}
                <div>
                    <label for="{{ form.checklistTemplate.vars.id }}" class="block text-sm font-semibold text-ink uppercase tracking-wider mb-2">
                        {{ form_label(form.checklistTemplate) }}
                    </label>
                    {{ form_widget(form.checklistTemplate) }}
                    <p class="text-xs text-muted mt-2">
                        Le template de checklist sera applique aux nouvelles operations au demarrage.
                    </p>
                    {{ form_errors(form.checklistTemplate) }}
                </div>

                <div class="flex items-center gap-4 pt-4 border-t border-ink/10">
                    <button type="submit" class="flex items-center gap-2 px-6 py-3 text-sm font-semibold text-white bg-ink hover:bg-ink/90 transition-colors">
                        <i data-feather="save" class="w-4 h-4"></i>
                        Enregistrer
                    </button>
                    <a href="{{ path('app_dashboard_campagne', {id: campagne.id}) }}" class="px-6 py-3 text-sm font-medium text-muted hover:text-ink transition-colors">
                        Annuler
                    </a>
                </div>

                {{ form_end(form) }}
            </div>
        </div>
    </div>
</div>
{% endblock %}
