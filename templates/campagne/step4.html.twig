{% extends 'campagne/_layout.html.twig' %}

{% block title %}Configuration - {{ campagne.nom }} - OpsTracker{% endblock %}

{% block main %}
{# HEADER #}
<header class="bg-white px-12 py-10 border-b-4 border-ink">
    <div class="flex justify-between items-end">
        <div>
            <div class="flex items-center gap-3 mb-2">
                <div class="w-3 h-3 bg-primary"></div>
                <span class="text-xs font-semibold text-muted uppercase tracking-[0.15em]">Etape {{ step }}/4</span>
            </div>
            <h1 class="text-4xl font-bold tracking-tight">{{ campagne.nom }}</h1>
            <p class="text-muted mt-2">Workflow & Template</p>
        </div>
        <a href="{{ path('app_campagne_index') }}" class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-muted hover:text-ink transition-colors">
            <i data-feather="arrow-left" class="w-4 h-4"></i>
            Retour aux campagnes
        </a>
    </div>
</header>

{# CONTENT #}
<div class="flex-1 overflow-auto">
    <div class="max-w-2xl mx-auto px-12 py-10">

        {# Progress steps #}
        <div class="flex items-center gap-4 mb-12">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-success text-white flex items-center justify-center">
                    <i data-feather="check" class="w-5 h-5"></i>
                </div>
                <span class="text-sm font-medium text-success">Infos</span>
            </div>
            <div class="flex-1 h-0.5 bg-success"></div>
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-success text-white flex items-center justify-center">
                    <i data-feather="check" class="w-5 h-5"></i>
                </div>
                <span class="text-sm font-medium text-success">Import</span>
            </div>
            <div class="flex-1 h-0.5 bg-success"></div>
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-success text-white flex items-center justify-center">
                    <i data-feather="check" class="w-5 h-5"></i>
                </div>
                <span class="text-sm font-medium text-success">Mapping</span>
            </div>
            <div class="flex-1 h-0.5 bg-success"></div>
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-primary text-white flex items-center justify-center font-bold">4</div>
                <span class="text-sm font-medium text-ink">Config</span>
            </div>
        </div>

        {# Recap campagne #}
        <div class="bg-paper border-2 border-ink/10 p-6 mb-8">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-primary/10 flex items-center justify-center">
                    <i data-feather="layers" class="w-6 h-6 text-primary"></i>
                </div>
                <div>
                    <h3 class="font-bold text-ink">{{ campagne.nom }}</h3>
                    <p class="text-sm text-muted">{{ campagne.dateDebut|date('d M Y') }} - {{ campagne.dateFin|date('d M Y') }}</p>
                </div>
            </div>
        </div>

        {# Import errors if any #}
        {% if import_errors is defined and import_errors|length > 0 %}
        <div class="bg-warning/5 border-2 border-warning p-6 mb-8">
            <div class="flex items-start gap-3 mb-4">
                <i data-feather="alert-triangle" class="w-5 h-5 text-warning mt-0.5"></i>
                <div>
                    <h3 class="font-bold text-warning">{{ import_errors|length }} ligne(s) ignoree(s) lors de l'import</h3>
                    <p class="text-sm text-muted mt-1">Les lignes ci-dessous contenaient des erreurs et n'ont pas ete importees.</p>
                </div>
            </div>
            <div class="max-h-48 overflow-y-auto bg-white border border-ink/10 p-4">
                <table class="w-full text-xs">
                    <thead>
                        <tr class="text-left">
                            <th class="pb-2 font-semibold text-ink">Ligne</th>
                            <th class="pb-2 font-semibold text-ink">Champ</th>
                            <th class="pb-2 font-semibold text-ink">Erreur</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for error in import_errors %}
                        <tr class="border-t border-ink/5">
                            <td class="py-2 text-muted">{{ error.line }}</td>
                            <td class="py-2 text-muted">{{ error.field }}</td>
                            <td class="py-2 text-danger">{{ error.message }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        {# Form #}
        <div class="bg-white border-2 border-ink p-8">
            <h2 class="text-lg font-bold text-ink mb-6">Configuration du workflow</h2>

            {{ form_start(form, {'attr': {'class': 'space-y-6'}}) }}

            <div class="space-y-6">
                <div>
                    <p class="text-sm text-muted mb-4">Selectionnez le type d'operation qui definit les champs personnalises pour vos cibles.</p>
                    {{ form_row(form.typeOperation) }}
                </div>

                <div class="border-t-2 border-ink/10 pt-6">
                    <p class="text-sm text-muted mb-4">Selectionnez le template de checklist qui sera utilise pour les interventions.</p>
                    {{ form_row(form.checklistTemplate) }}
                </div>
            </div>

            <div class="flex justify-between items-center gap-4 pt-6 border-t-2 border-ink/10">
                <a href="{{ path('app_dashboard_campagne', {id: campagne.id}) }}" class="px-6 py-3 text-sm font-semibold text-muted hover:text-ink transition-colors">
                    Passer cette etape
                </a>
                <button type="submit" class="flex items-center gap-2 px-6 py-3 text-sm font-semibold text-white bg-ink hover:bg-ink/90 transition-colors">
                    <i data-feather="check" class="w-4 h-4"></i>
                    Terminer
                </button>
            </div>

            {{ form_end(form) }}
        </div>

    </div>
</div>
{% endblock %}
