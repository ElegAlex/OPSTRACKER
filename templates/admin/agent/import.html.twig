{% extends '@EasyAdmin/page/content.html.twig' %}

{% block content_title %}Importer des agents{% endblock %}

{% block page_actions %}
    <a href="{{ ea_url().setController('App\\\\Controller\\\\Admin\\\\AgentCrudController').setAction('index') }}" class="btn btn-secondary">
        <i class="fa fa-arrow-left"></i> Retour a la liste
    </a>
{% endblock %}

{% block main %}
<div class="card">
    <div class="card-header">
        <h5 class="card-title mb-0">
            <i class="fa fa-upload"></i> Import CSV
        </h5>
    </div>
    <div class="card-body">
        <form method="POST" enctype="multipart/form-data">
            <div class="mb-4">
                <label class="form-label fw-bold">Fichier CSV *</label>
                <input type="file" name="csv_file" accept=".csv" class="form-control" required>
                <div class="form-text">
                    <strong>Colonnes obligatoires :</strong> matricule, email, nom, prenom<br>
                    <strong>Colonnes optionnelles :</strong> service, site, role, type_contrat<br>
                    <strong>Separateur :</strong> point-virgule (;) ou virgule (,)
                </div>
            </div>

            <div class="mb-4">
                <div class="form-check">
                    <input type="checkbox" name="update_existing" value="1" class="form-check-input" id="updateExisting">
                    <label class="form-check-label" for="updateExisting">
                        Mettre a jour les agents existants (par matricule)
                    </label>
                </div>
                <div class="form-text">
                    Si decoche, les agents avec un matricule deja existant seront ignores.
                </div>
            </div>

            <div class="mb-4 p-3 bg-light rounded">
                <strong><i class="fa fa-info-circle"></i> Besoin d'un modele ?</strong><br>
                <a href="{{ path('admin_agent_import_template') }}" class="btn btn-outline-secondary btn-sm mt-2">
                    <i class="fa fa-download"></i> Telecharger le modele CSV
                </a>
            </div>

            <hr>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="fa fa-upload"></i> Importer
                </button>
                <a href="{{ ea_url().setController('App\\\\Controller\\\\Admin\\\\AgentCrudController').setAction('index') }}" class="btn btn-secondary">
                    Annuler
                </a>
            </div>
        </form>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        <h5 class="card-title mb-0">
            <i class="fa fa-question-circle"></i> Aide
        </h5>
    </div>
    <div class="card-body">
        <h6>Format du fichier CSV</h6>
        <p>Le fichier doit contenir une ligne d'en-tete avec les noms des colonnes :</p>
        <pre class="bg-dark text-light p-3 rounded">matricule;email;nom;prenom;service;site;role;type_contrat
A001;jean.dupont@cpam.fr;Dupont;Jean;Prestations Maladie;Siege;agent;CDI
A002;marie.martin@cpam.fr;Martin;Marie;RH;Siege;manager;CDI</pre>

        <h6 class="mt-4">Valeurs possibles</h6>
        <ul>
            <li><strong>role :</strong> agent, manager, coordinateur...</li>
            <li><strong>type_contrat :</strong> CDI, CDD, Interim, Prestataire...</li>
        </ul>
    </div>
</div>
{% endblock %}
