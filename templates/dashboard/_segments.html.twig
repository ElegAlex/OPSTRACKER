<turbo-frame id="segments-list">
{# ===== SECTION PROGRESSION ===== #}
<div class="bg-white border-2 border-ink">

    {# Header principal #}
    <div class="px-6 py-4 border-b border-ink/10 flex items-center justify-between">
        <h3 class="font-semibold text-ink flex items-center gap-2">
            <span class="w-3 h-3 bg-primary rounded-sm"></span>
            Progression
        </h3>
        <span class="text-sm text-muted">
            {{ segments|length }} segment{{ segments|length > 1 ? 's' : '' }} â€¢ {{ kpi.total ?? 0 }} operations
        </span>
    </div>

    {# ===== SOUS-SECTION PREREQUIS GLOBAUX ===== #}
    {% if prerequisGlobauxStats is defined and prerequisGlobauxStats.total > 0 %}
        <div class="px-6 py-4 border-b border-ink/10">
            {# Titre sous-section #}
            <div class="flex items-center gap-2 mb-4">
                <span class="w-2 h-2 bg-ink rounded-sm"></span>
                <span class="text-sm font-bold text-ink uppercase tracking-wide">Prerequis globaux</span>
            </div>

            {# Contenu #}
            <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-muted">{{ prerequisGlobauxStats.fait }}/{{ prerequisGlobauxStats.total }}</span>
                <span class="font-semibold {{ prerequisGlobauxStats.progression == 100 ? 'text-success' : 'text-ink' }}">
                    {{ prerequisGlobauxStats.progression }}%
                </span>
            </div>
            <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                <div class="h-full rounded-full {{ prerequisGlobauxStats.progression == 100 ? 'bg-success' : 'bg-primary' }}"
                     style="width: {{ prerequisGlobauxStats.progression }}%"></div>
            </div>
        </div>
    {% endif %}

    {# ===== SOUS-SECTION PROGRESSION PAR SEGMENT ===== #}
    <div class="px-6 py-4">
        {# Titre sous-section #}
        <div class="flex items-center gap-2 mb-4">
            <span class="w-2 h-2 bg-ink rounded-sm"></span>
            <span class="text-sm font-bold text-ink uppercase tracking-wide">Progression par segment</span>
        </div>

        {% if segments|length == 0 %}
            <div class="py-8 text-center text-muted">
                <i data-feather="layers" class="w-12 h-12 mx-auto mb-4 text-ink/20"></i>
                <p class="font-medium">Aucun segment</p>
                <p class="text-sm mt-1">Creez des segments pour organiser vos operations</p>
                <a href="{{ path('app_segment_new', {campagne: campagne.id}) }}" class="inline-flex items-center gap-2 mt-4 px-4 py-2 bg-ink text-white text-sm font-medium hover:bg-ink/90 transition-colors">
                    <i data-feather="plus" class="w-4 h-4"></i>
                    Creer un segment
                </a>
            </div>
        {% else %}
            {# Liste segments #}
            <div class="space-y-6">
                {% for item in segments %}
                    <a href="{{ path('app_segment_show', {campagne: campagne.id, id: item.segment.id}) }}" class="block cursor-pointer hover:bg-paper/50 -mx-2 px-2 py-2 rounded transition-colors">
                        {# Ligne titre segment #}
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-sm" style="background-color: {{ item.segment.couleur ?? '#3b82f6' }}"></span>
                                <span class="font-medium text-ink">{{ item.segment.nom }}</span>
                                <span class="text-sm text-muted">{{ item.total }} operation{{ item.total > 1 ? 's' : '' }}</span>
                                {% if item.is_late %}
                                    <span class="px-2 py-0.5 text-xs font-semibold bg-danger text-white rounded">EN RETARD</span>
                                {% endif %}
                            </div>
                            <span class="font-semibold {{ item.is_late ? 'text-danger' : 'text-ink' }}">
                                {{ item.progression|round }}%
                            </span>
                        </div>

                        {# Barre multi-couleur #}
                        <div class="h-3 bg-gray-100 rounded-full overflow-hidden flex mb-2">
                            {% set total = item.total %}
                            {% if total > 0 %}
                                <div class="h-full bg-success" style="width: {{ (item.realise / total * 100) }}%"></div>
                                <div class="h-full bg-primary" style="width: {{ (item.planifie / total * 100) }}%"></div>
                                <div class="h-full bg-warning" style="width: {{ (item.reporte / total * 100) }}%"></div>
                                <div class="h-full bg-danger" style="width: {{ (item.a_remedier / total * 100) }}%"></div>
                            {% endif %}
                        </div>

                        {# Legende #}
                        <div class="flex items-center gap-4 text-xs text-muted">
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-success"></span>{{ item.realise }} realise{{ item.realise > 1 ? 's' : '' }}</span>
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-primary"></span>{{ item.planifie }} planifie{{ item.planifie > 1 ? 's' : '' }}</span>
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-warning"></span>{{ item.reporte }} reporte{{ item.reporte > 1 ? 's' : '' }}</span>
                            <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-danger"></span>{{ item.a_remedier }} a remedier</span>
                        </div>

                        {# Prerequis segment si existants #}
                        {% if item.prerequis is defined and item.prerequis.total > 0 %}
                            <div class="mt-3 ml-5 pl-3 border-l-2 border-gray-200">
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-muted">Prerequis : {{ item.prerequis.fait }}/{{ item.prerequis.total }}</span>
                                    <span class="{{ item.prerequis.progression == 100 ? 'text-success' : 'text-muted' }}">{{ item.prerequis.progression }}%</span>
                                </div>
                                <div class="mt-1 h-1.5 bg-gray-100 rounded-full overflow-hidden">
                                    <div class="h-full rounded-full {{ item.prerequis.progression == 100 ? 'bg-success' : 'bg-primary' }}"
                                         style="width: {{ item.prerequis.progression }}%"></div>
                                </div>
                            </div>
                        {% endif %}
                    </a>
                {% endfor %}
            </div>
        {% endif %}
    </div>

</div>
</turbo-frame>
